<!doctype html>
<html lang="lt">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Stalo Å¾aidimÅ³ vakaras</title>
  <style>
    :root{
      --bg:#071733; --card:rgba(255,255,255,.06); --border:rgba(255,255,255,.14);
      --text:#eaf1ff; --muted:rgba(234,241,255,.78);
      --ok:#68ffb3; --warn:#ffd36b; --bad:#ff6b6b;
    }
    body{margin:0;font-family:system-ui,Segoe UI,Arial,sans-serif;background:var(--bg);color:var(--text);}
    .wrap{max-width:980px;margin:0 auto;padding:20px;}
    .header{
      border:1px solid var(--border); background:var(--card); border-radius:18px;
      padding:16px 16px 14px; margin-bottom:14px;
    }
    h1{margin:0 0 6px;font-size:20px;}
    h2{margin:0 0 10px;font-size:16px;}
    .muted{color:var(--muted); font-size:13px; margin:0;}
    .suben{display:block; font-size:12px; color:rgba(234,241,255,.70); margin-top:2px;}
    .row{display:grid; grid-template-columns: 1fr; gap:14px;}
    @media(min-width: 920px){ .row{grid-template-columns: 1.05fr .95fr;} }

    .card{border:1px solid var(--border); background:var(--card); border-radius:18px; padding:16px;}
    label{display:block;margin:10px 0 6px;font-weight:650;}
    input, textarea, select{
      width:100%; box-sizing:border-box; padding:10px 12px;
      border:1px solid rgba(255,255,255,.18);
      border-radius:12px; background:rgba(0,0,0,.20); color:var(--text);
      font-size:15px;
    }
    textarea{min-height:90px; resize:vertical;}
    button{
      margin-top:12px; padding:10px 12px; border-radius:12px; border:1px solid rgba(255,255,255,.18);
      background:rgba(255,255,255,.10); color:var(--text); cursor:pointer; font-weight:650;
    }
    button:hover{background:rgba(255,255,255,.14);}
    .pill{
      display:inline-block; padding:6px 10px; border-radius:999px;
      border:1px solid rgba(255,255,255,.18); background:rgba(0,0,0,.15); font-size:12px;
      margin-right:8px;
    }
    .status{margin-top:10px; font-weight:650;}
    .status.ok{color:var(--ok);}
    .status.warn{color:var(--warn);}
    .status.bad{color:var(--bad);}
    .tiny{font-size:12px; color:var(--muted); margin-top:10px;}
    .adminBadge{display:none;}
    .adminOn .adminBadge{display:inline-block;}
    .adminOnly{display:none;}
    .adminOn .adminOnly{display:block;}
    .danger{background:rgba(255,107,107,.10); border-color:rgba(255,107,107,.25);}

    /* Game list */
    .gameItem{
      border:1px solid rgba(255,255,255,.14);
      background:rgba(0,0,0,.16);
      border-radius:14px;
      padding:12px;
      margin-top:10px;
    }
    .gameTop{
      display:flex; justify-content:space-between; gap:12px; flex-wrap:wrap; align-items:flex-start;
    }
    .gameTitle{font-weight:800; font-size:16px; margin:0;}
    .gameMeta{margin:6px 0 0; color:var(--muted); font-size:13px; line-height:1.35;}
    .voteBox{display:flex; align-items:center; gap:8px;}
    .voteBtn{
      margin:0;
      padding:8px 10px;
      border-radius:12px;
      border:1px solid rgba(255,255,255,.18);
      background:rgba(255,255,255,.08);
      cursor:pointer;
      font-weight:800;
    }
    .voteBtn:hover{background:rgba(255,255,255,.12);}
    .score{
      min-width:48px;
      text-align:center;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.18);
      background:rgba(0,0,0,.12);
      font-weight:800;
    }
    .gameDesc{margin:10px 0 0; font-size:14px; color:rgba(234,241,255,.92);}
    .grid2{display:grid; grid-template-columns: 1fr; gap:10px;}
    @media(min-width:680px){ .grid2{grid-template-columns: 1fr 1fr;} }

    .footnote{
      margin-top:10px;
      padding-top:10px;
      border-top:1px dashed rgba(255,255,255,.18);
      font-size:12px;
      color:rgba(234,241,255,.74);
      line-height:1.35;
    }
  </style>
</head>
<body>
  <div class="wrap">

    <!-- HEADER 1: Event -->
    <div id="topHeader" class="header">
      <div style="display:flex; justify-content:space-between; gap:12px; align-items:flex-start; flex-wrap:wrap;">
        <div>
          <h1>
            Stalo Å¾aidimÅ³ vakaras â€” registracija
            <span class="pill adminBadge">ADMIN</span>
          </h1>
          <p class="muted" id="eventLine">Ä®keliamaâ€¦<span class="suben" id="eventLineEn"></span></p>
          <p class="muted" id="notesLine"></p>
        </div>
        <div>
          <span class="pill" id="countPill">0 uÅ¾siregistravo</span>
          <span class="pill" id="datePill">â€”</span>
        </div>
      </div>

      <div id="whoBlock" style="margin-top:10px;">
        <p class="muted" style="margin:0 0 6px;">
          UÅ¾siregistravÄ™:
          <span class="suben">Registered:</span>
        </p>
        <div id="whoList" class="muted">â€”</div>
      </div>

      <div class="tiny">
        Dalyvavimas nebÅ«tinas, bet reikalinga registracija.
        <span class="suben">Participation optional, but registration is required.</span>
      </div>
    </div>

    <!-- HEADER 2: Game suggestions + voting -->
    <div id="gamesHeader" class="header">
      <div style="display:flex; justify-content:space-between; gap:12px; align-items:flex-start; flex-wrap:wrap;">
        <div>
          <h1 style="margin-bottom:6px;">Å½aidimÅ³ pasiÅ«lymai ir balsavimas</h1>
          <p class="muted">
            PasiÅ«lyk Å¾aidimÄ… ir balsuok, kÄ… Å¾aisime.
            <span class="suben">Suggest a game and vote on what we should play.</span>
          </p>
        </div>
        <div>
          <span class="pill" id="gameCountPill">0 pasiÅ«lymÅ³</span>
          <span class="pill" id="sortPill">rikiuojama pagal balsus<span class="suben" style="margin:0;">sorted by votes</span></span>
        </div>
      </div>

      <div id="gameList"></div>

      <div class="footnote">
        SudÄ—tingumas: jei taisykliÅ³ puslapiÅ³ skaiÄius daugiau nei 10, tai yra sudÄ—tingas Å¾aidimas.
        <span class="suben">Complexity: if the rulebook has more than 10 pages, the game is considered complex.</span>
      </div>
    </div>

    <div class="row">

      <!-- Participant registration -->
      <div class="card">
        <h2>Registracija<span class="suben">Registration</span></h2>
        <form id="regForm">
          <label for="name">Vardas, pavardÄ—<span class="suben">Name</span></label>
          <input id="name" name="name" type="text" minlength="2" maxlength="60" placeholder="Pvz., Audrius PreikÅ¡as" required />
          <button type="submit">UÅ¾siregistruoti<span class="suben">Register</span></button>
        </form>
        <div id="regStatus" class="status" aria-live="polite"></div>
        <div class="tiny">
          Registruojiesi Ä¯ datÄ…, kuri rodoma virÅ¡uje.
          <span class="suben">Youâ€™re registering for the date shown above.</span>
        </div>
      </div>

      <!-- Suggest a board game -->
      <div class="card">
        <h2>SiÅ«lyti stalo Å¾aidimÄ…<span class="suben">Suggest a board game</span></h2>
        <form id="gameForm">
          <label for="gTitle">Å½aidimo pavadinimas<span class="suben">Game title</span></label>
          <input id="gTitle" name="gTitle" type="text" minlength="2" maxlength="80" placeholder="Pvz., Codenames" required />

          <div class="grid2">
            <div>
              <label for="gDifficulty">SudÄ—tingumas (1/2/3)<span class="suben">Complexity (1/2/3)</span></label>
              <select id="gDifficulty" name="gDifficulty" required>
                <option value="">Pasirinktiâ€¦</option>
                <option value="1">1 (lengvas)</option>
                <option value="2">2 (vidutinis)</option>
                <option value="3">3 (sunkesnis)</option>
              </select>
            </div>
            <div>
              <label for="gHost">Reikalingas vedÄ—jas (Taip/Ne)<span class="suben">Needs a host (Yes/No)</span></label>
              <select id="gHost" name="gHost" required>
                <option value="">Pasirinktiâ€¦</option>
                <option value="no">Ne</option>
                <option value="yes">Taip</option>
              </select>
            </div>
          </div>

          <div class="grid2">
            <div>
              <label for="gPlayers">Å½aidÄ—jÅ³ skaiÄius be vedÄ—jo*<span class="suben">Player count without a host*</span></label>
              <input id="gPlayers" name="gPlayers" type="text" maxlength="20" placeholder="Pvz., 2â€“6" required />
            </div>
            <div>
              <label for="gType">Å½aidimo tipas (co-op / comp)<span class="suben">Type (co-op / competitive)</span></label>
              <select id="gType" name="gType" required>
                <option value="">Pasirinktiâ€¦</option>
                <option value="coop">Co-op</option>
                <option value="comp">Competitive</option>
              </select>
            </div>
          </div>

          <label for="gDesc">Trumpas apraÅ¡ymas<span class="suben">Short description</span></label>
          <textarea id="gDesc" name="gDesc" maxlength="280" placeholder="1â€“2 sakiniai: kuo smagus, kiek trunka, ar lengva iÅ¡moktiâ€¦" required></textarea>

          <button type="submit">Pateikti pasiÅ«lymÄ…<span class="suben">Submit suggestion</span></button>
        </form>
        <div id="gameStatus" class="status" aria-live="polite"></div>
      </div>

      <!-- Admin panel -->
      <div class="card adminOnly" id="adminCard">
        <h2>Admin: renginio data<span class="suben">Admin: event date</span></h2>
        <form id="adminForm">
          <label for="eventDate">Renginio data<span class="suben">Event date</span></label>
          <input id="eventDate" name="eventDate" type="date" required />
          <label for="eventNotes">Pastabos (nebÅ«tina)<span class="suben">Notes (optional)</span></label>
          <textarea id="eventNotes" name="eventNotes" placeholder="Pvz., Ketvirtadienis, startas 17:00â€¦"></textarea>
          <button type="submit">IÅ¡saugoti<span class="suben">Save</span></button>
        </form>

        <button class="danger" id="clearRegsBtn" type="button" title="Clears registrations for current event">
          IÅ¡valyti registracijas Å¡iai datai
          <span class="suben">Clear registrations for this date</span>
        </button>

        <button class="danger" id="clearGamesBtn" type="button" title="Clears game suggestions">
          IÅ¡valyti Å¾aidimÅ³ pasiÅ«lymus ir balsus (Å¡iame Ä¯renginyje)
          <span class="suben">Clear game suggestions & votes (this device)</span>
        </button>

        <div id="adminStatus" class="status" aria-live="polite"></div>
        <div class="tiny">
          Admin reÅ¾imas Ä¯jungiamas per nuorodos galÄ…: <code>#admin=YOUR_KEY</code>
          <span class="suben">Enable admin mode via URL hash: <code>#admin=YOUR_KEY</code></span>
        </div>
      </div>

      <!-- Non-admin hint -->
      <div class="card" id="nonAdminHint">
        <h2>Organizatorius?<span class="suben">Organizer?</span></h2>
        <p class="muted" style="margin:0;">
          Admin Ä¯rankiai paslÄ—pti. Ä®junk admin reÅ¾imÄ… atsidarÄ™s puslapÄ¯ su:
          <span class="suben">Admin tools are hidden. Enable admin mode by opening:</span>
          <br><code>#admin=YOUR_KEY</code>
        </p>
      </div>

    </div>
  </div>

<script>
const ADMIN_KEY = "CHANGE_ME_TO_A_SECRET";

const STORAGE_EVENT = "sbep_event_v1";
const STORAGE_REGS  = "sbep_regs_v1";

const STORAGE_GAMES = "sbep_games_v1";
const STORAGE_VOTES = "sbep_votes_v1";

const $ = (id) => document.getElementById(id);

function isAdmin() {
  const hash = window.location.hash || "";
  const m = hash.match(/admin=([^&]+)/);
  if (!m) return false;
  try { return decodeURIComponent(m[1]) === ADMIN_KEY; } catch { return false; }
}

function loadEvent() {
  const raw = localStorage.getItem(STORAGE_EVENT);
  if (raw) { try { return JSON.parse(raw); } catch {} }
  return { date: "2026-01-16", notes: "" };
}
function saveEvent(evt) { localStorage.setItem(STORAGE_EVENT, JSON.stringify(evt)); }

function loadRegsMap() {
  const raw = localStorage.getItem(STORAGE_REGS);
  if (raw) { try { return JSON.parse(raw); } catch {} }
  return {};
}
function saveRegsMap(map) { localStorage.setItem(STORAGE_REGS, JSON.stringify(map)); }

function sanitizeName(name) {
  return String(name || "").trim().replace(/\s+/g, " ");
}

function getRegsForDate(date) {
  const map = loadRegsMap();
  return Array.isArray(map[date]) ? map[date] : [];
}
function setRegsForDate(date, regs) {
  const map = loadRegsMap();
  map[date] = regs;
  saveRegsMap(map);
}

// ---------- Games ----------
function loadGames() {
  const raw = localStorage.getItem(STORAGE_GAMES);
  if (raw) { try { return JSON.parse(raw); } catch {} }
  return [];
}
function saveGames(games) { localStorage.setItem(STORAGE_GAMES, JSON.stringify(games)); }

function loadVotes() {
  const raw = localStorage.getItem(STORAGE_VOTES);
  if (raw) { try { return JSON.parse(raw); } catch {} }
  return {};
}
function saveVotes(votes) { localStorage.setItem(STORAGE_VOTES, JSON.stringify(votes)); }

function uid() {
  return (crypto?.randomUUID?.() || ("id-" + Math.random().toString(16).slice(2) + Date.now()));
}
function normalizeTitle(t) {
  return String(t || "").trim().replace(/\s+/g, " ");
}
function metaText(g) {
  const host = (g.host === "yes") ? "vedÄ—jas: taip" : "vedÄ—jas: ne";
  const type = (g.type === "coop") ? "co-op" : "competitive";
  return `SudÄ—tingumas: ${g.difficulty} â€¢ ${host} â€¢ Å¾aidÄ—jai: ${g.players} â€¢ tipas: ${type}`;
}
function escapeHtml(s) {
  return String(s ?? "")
    .replaceAll("&","&amp;").replaceAll("<","&lt;")
    .replaceAll(">","&gt;").replaceAll('"',"&quot;")
    .replaceAll("'","&#039;");
}

function renderGames() {
  const games = loadGames();
  const votes = loadVotes();

  const sorted = [...games].sort((a,b) => {
    const sa = (votes[a.id] || 0);
    const sb = (votes[b.id] || 0);
    if (sb !== sa) return sb - sa;
    return (b.createdAt || "").localeCompare(a.createdAt || "");
  });

  $("gameCountPill").textContent = `${games.length} pasiÅ«lymÅ³`;

  if (sorted.length === 0) {
    $("gameList").innerHTML = `<p class="muted" style="margin-top:10px;">
      Kol kas nÄ—ra pasiÅ«lymÅ³ â€” pridÄ—k savo ğŸ™‚<span class="suben">No suggestions yet â€” add one ğŸ™‚</span>
    </p>`;
    return;
  }

  $("gameList").innerHTML = sorted.map(g => {
    const score = votes[g.id] || 0;
    return `
      <div class="gameItem">
        <div class="gameTop">
          <div style="min-width:240px; flex:1;">
            <p class="gameTitle">${escapeHtml(g.title)}</p>
            <p class="gameMeta">${escapeHtml(metaText(g))}</p>
          </div>
          <div class="voteBox" aria-label="Balsavimas / Voting">
            <button class="voteBtn" data-vote="-1" data-id="${g.id}" title="Minus / Downvote">âˆ’</button>
            <div class="score" title="Balsai / Score">${score}</div>
            <button class="voteBtn" data-vote="1" data-id="${g.id}" title="Plius / Upvote">+</button>
          </div>
        </div>
        <div class="gameDesc">${escapeHtml(g.desc)}</div>
      </div>
    `;
  }).join("");

  document.querySelectorAll(".voteBtn").forEach(btn => {
    btn.addEventListener("click", () => {
      const id = btn.getAttribute("data-id");
      const v = Number(btn.getAttribute("data-vote")) || 0;

      const votesNow = loadVotes();
      const current = votesNow[id] || 0;

      // Toggle: clicking same vote again removes it
      const next = (current === v) ? 0 : v;
      votesNow[id] = next;
      saveVotes(votesNow);
      renderGames();
    });
  });
}

// ---------- Render all ----------
function render() {
  const admin = isAdmin();
  document.body.classList.toggle("adminOn", admin);

  $("adminCard").style.display = admin ? "block" : "none";
  $("nonAdminHint").style.display = admin ? "none" : "block";

  const evt = loadEvent();
  const regs = getRegsForDate(evt.date);

  $("eventLine").firstChild.textContent = `Renginio data: ${evt.date}`;
  $("eventLineEn").textContent = `Event date: ${evt.date}`;
  $("datePill").textContent = evt.date;

  const notes = (evt.notes || "").trim();
  $("notesLine").textContent = notes ? `Info: ${notes}` : "";
  if (notes) $("notesLine").innerHTML = `Info: ${escapeHtml(notes)}<span class="suben">Info: ${escapeHtml(notes)}</span>`;

  $("countPill").textContent = `${regs.length} uÅ¾siregistravo`;

  if (regs.length === 0) {
    $("whoList").textContent = "Kol kas nieko ğŸ™‚";
  } else {
    $("whoList").textContent = regs.map(r => r.name).join(", ");
  }

  if (admin) {
    $("eventDate").value = evt.date;
    $("eventNotes").value = evt.notes || "";
  }

  renderGames();
}

// ---------- Registration ----------
$("regForm").addEventListener("submit", (e) => {
  e.preventDefault();
  const evt = loadEvent();
  const name = sanitizeName($("name").value);

  const status = $("regStatus");
  status.textContent = "";
  status.className = "status";

  if (name.length < 2) {
    status.innerHTML = `Ä®vesk vardÄ… (min 2 simboliai).<span class="suben">Please enter your name (min 2 characters).</span>`;
    status.classList.add("warn");
    return;
  }

  const regs = getRegsForDate(evt.date);
  const exists = regs.some(r => r.name.toLowerCase() === name.toLowerCase());
  if (exists) {
    status.innerHTML = `Jau esi uÅ¾siregistravÄ™s Å¡iai datai.<span class="suben">You're already registered for this date.</span>`;
    status.classList.add("warn");
    return;
  }

  regs.push({ name, ts: new Date().toISOString() });
  setRegsForDate(evt.date, regs);

  status.innerHTML = `AÄiÅ«, ${escapeHtml(name)}! UÅ¾registruota.<span class="suben">Thanks, ${escapeHtml(name)}! Registered.</span>`;
  status.classList.add("ok");

  $("regForm").reset();
  $("name").focus();
  render();
});

// ---------- Game suggestion ----------
$("gameForm").addEventListener("submit", (e) => {
  e.preventDefault();

  const status = $("gameStatus");
  status.textContent = "";
  status.className = "status";

  const title = normalizeTitle($("gTitle").value);
  const difficulty = $("gDifficulty").value;
  const host = $("gHost").value;
  const players = normalizeTitle($("gPlayers").value);
  const type = $("gType").value;
  const desc = normalizeTitle($("gDesc").value);

  if (title.length < 2) {
    status.innerHTML = `Ä®raÅ¡yk Å¾aidimo pavadinimÄ….<span class="suben">Please enter a game title.</span>`;
    status.classList.add("warn");
    return;
  }
  if (!difficulty || !host || !type) {
    status.innerHTML = `UÅ¾pildyk sudÄ—tingumÄ…, vedÄ—jÄ… ir tipÄ….<span class="suben">Please fill complexity, host and type.</span>`;
    status.classList.add("warn");
    return;
  }
  if (players.length < 1) {
    status.innerHTML = `Ä®raÅ¡yk Å¾aidÄ—jÅ³ skaiÄiÅ³ (pvz., 2â€“6).<span class="suben">Enter player count (e.g., 2â€“6).</span>`;
    status.classList.add("warn");
    return;
  }
  if (desc.length < 3) {
    status.innerHTML = `ApraÅ¡ymas per trumpas.<span class="suben">Description is too short.</span>`;
    status.classList.add("warn");
    return;
  }

  const games = loadGames();
  const dup = games.some(g => g.title.toLowerCase() === title.toLowerCase());
  if (dup) {
    status.innerHTML = `Å is Å¾aidimas jau pasiÅ«lytas.<span class="suben">This game has already been suggested.</span>`;
    status.classList.add("warn");
    return;
  }

  games.push({
    id: uid(),
    title,
    difficulty: Number(difficulty),
    host,
    players,
    type,
    desc,
    createdAt: new Date().toISOString()
  });
  saveGames(games);

  status.innerHTML = `AÄiÅ«! PasiÅ«lymas pridÄ—tas.<span class="suben">Thanks! Suggestion added.</span>`;
  status.classList.add("ok");

  $("gameForm").reset();
  $("gTitle").focus();
  renderGames();
});

// ---------- Admin ----------
$("adminForm").addEventListener("submit", (e) => {
  e.preventDefault();
  const status = $("adminStatus");
  status.textContent = "";
  status.className = "status";

  if (!isAdmin()) {
    status.innerHTML = `Admin reÅ¾imas neÄ¯jungtas.<span class="suben">Admin mode not enabled.</span>`;
    status.classList.add("warn");
    return;
  }

  const date = $("eventDate").value;
  if (!date) {
    status.innerHTML = `Pasirink datÄ….<span class="suben">Please select a date.</span>`;
    status.classList.add("warn");
    return;
  }

  const notes = ($("eventNotes").value || "").trim();
  saveEvent({ date, notes });

  status.innerHTML = `IÅ¡saugota: ${escapeHtml(date)}<span class="suben">Saved: ${escapeHtml(date)}</span>`;
  status.classList.add("ok");
  render();
});

$("clearRegsBtn").addEventListener("click", () => {
  const status = $("adminStatus");
  status.textContent = "";
  status.className = "status";

  if (!isAdmin()) {
    status.innerHTML = `Admin reÅ¾imas neÄ¯jungtas.<span class="suben">Admin mode not enabled.</span>`;
    status.classList.add("warn");
    return;
  }

  const evt = loadEvent();
  setRegsForDate(evt.date, []);

  status.innerHTML = `IÅ¡valytos registracijos: ${escapeHtml(evt.date)}<span class="suben">Cleared registrations: ${escapeHtml(evt.date)}</span>`;
  status.classList.add("ok");
  render();
});

$("clearGamesBtn").addEventListener("click", () => {
  const status = $("adminStatus");
  status.textContent = "";
  status.className = "status";

  if (!isAdmin()) {
    status.innerHTML = `Admin reÅ¾imas neÄ¯jungtas.<span class="suben">Admin mode not enabled.</span>`;
    status.classList.add("warn");
    return;
  }

  localStorage.removeItem(STORAGE_GAMES);
  localStorage.removeItem(STORAGE_VOTES);

  status.innerHTML = `IÅ¡valyta (Å¡iame Ä¯renginyje).<span class="suben">Cleared (on this device).</span>`;
  status.classList.add("ok");
  renderGames();
});

window.addEventListener("hashchange", render);
render();
</script>
</body>
</html>
